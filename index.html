<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>RUN EBE RUN — Doğumhaneye Ulaş!</title>
<style>
  :root{ --ink:#182031; --shadow:0 12px 34px rgba(0,0,0,.18);}
  html,body{margin:0;height:100%;background:#0e1624;color:var(--ink);font-family:ui-rounded,system-ui,"Segoe UI",Arial,sans-serif}
  #gameWrap{position:relative;width:100%;height:100vh;overflow:hidden}
  canvas{display:block;margin:0 auto;border-radius:18px;box-shadow:var(--shadow);background:#0e1624}
  /* panel */
  #panel{position:absolute;inset:0;display:flex;flex-direction:column;gap:12px;align-items:center;justify-content:center;
    text-align:center;padding:20px;background:linear-gradient(180deg,rgba(255,255,255,.7),rgba(255,255,255,.25));backdrop-filter:blur(8px)}
  input,button{padding:12px 16px;border:1px solid rgba(0,0,0,.08);border-radius:14px;background:#fff;font-weight:700}
  button{cursor:pointer;transition:.2s transform,.2s box-shadow} button:hover{transform:translateY(-1px);box-shadow:var(--shadow)}
  table{background:#fff;border-radius:14px;overflow:hidden;box-shadow:var(--shadow)} td,th{padding:8px 12px;border-bottom:1px solid rgba(0,0,0,.08)} th{background:#f4f7ff}
  /* mobil pad */
  #pad{position:absolute;left:0;right:0;bottom:14px;display:none;gap:10px;justify-content:center}
  .p{padding:14px 16px;border-radius:16px;background:#fff;border:1px solid rgba(0,0,0,.08)}
  @media (pointer:coarse){#pad{display:flex}}
</style>
</head>
<body>
<div id="gameWrap">
  <canvas id="game" width="1280" height="720"></canvas>

  <div id="panel">
    <div id="titleArea">
      <h1>RUN EBE RUN</h1>
      <h3>Doğumhaneye Ulaş!</h3>
      <p style="max-width:720px">
        Renkli <b>hastane yolunda</b> koş; <b>doğum malzemelerini</b> topla, engellerden ustalıkla sıyrıl!
      </p>
      <label for="ad">Oyuncu Adı</label>
      <input id="ad" maxlength="12" placeholder="Runebe"/>
      <div style="display:flex;gap:8px;flex-wrap:wrap;justify-content:center">
        <button id="basla">Başla</button>
        <button id="muzik">Müzik: Aç/Kapa (M)</button>
        <button id="lider">Liderlik Tablosu</button>
        <button id="yardim">Nasıl Oynanır?</button>
      </div>
      <small>← → hareket · Space zıpla (×2) · S kay · D kısa atıl · P duraklat · M müzik</small>
    </div>

    <div id="howto" style="display:none;max-width:760px;text-align:left">
      <h3>Nasıl Oynanır?</h3>
      <ul>
        <li>Toplanacaklar: <b>Doğum Seti (+30)</b>, <b>Şırınga (+18)</b>, <b>Kordon Makası (+20)</b>, <b>Bebek Bezi (+12)</b>, <b>Önlük (+14)</b>, <b>Eldiven (+10)</b>, <b>Maske (+12)</b></li>
        <li>Engeller: <b>Islak Temizlik Alanı</b>, <b>Ekipman Arabası</b>, <b>Servis Kapısı</b></li>
        <li>Her 60 malzeme sonrası hızın artar. 3 canın var.</li>
      </ul>
      <button id="kapatHow">Kapat</button>
    </div>

    <div id="lbArea" style="display:none">
      <h2>Liderlik Tablosu (İlk 10)</h2>
      <table id="lbTable"><thead><tr><th>#</th><th>Ad</th><th>Puan</th><th>Tarih</th></tr></thead><tbody></tbody></table>
      <button id="kapatLB">Kapat</button>
    </div>

    <div id="overArea" style="display:none">
      <h2>Oyun Bitti</h2>
      <p id="sonPuan">Puan: 0</p>
      <div style="display:flex;gap:8px;justify-content:center">
        <button id="yeniden">Yeniden</button>
        <button id="baslangic">Başlangıç</button>
      </div>
    </div>
  </div>

  <div id="pad">
    <button class="p" id="sol">◀</button>
    <button class="p" id="sag">▶</button>
    <button class="p" id="zip">⤒</button>
    <button class="p" id="kay">—</button>
    <button class="p" id="dash">⚡</button>
  </div>
</div>

<script>
/* ===== helpers ===== */
const $=s=>document.querySelector(s);
const W=1280,H=720;
const canvas=$('#game'), ctx=canvas.getContext('2d');
const LS_NAME='rer_tr_name', LS_LB='rer_tr_lb';

/* ===== music (light loop) ===== */
const Muzik=(()=>{
  let ctxA, master, beatG, melG, started=false, muted=false, timer;
  function init(){ if(ctxA) return;
    ctxA=new (window.AudioContext||window.webkitAudioContext)();
    master=ctxA.createGain(); master.gain.value=0.16; master.connect(ctxA.destination);
    beatG=ctxA.createGain(); beatG.gain.value=0.35; beatG.connect(master);
    melG =ctxA.createGain(); melG .gain.value=0.22; melG .connect(master);
  }
  function kick(t){ const o=ctxA.createOscillator(), g=ctxA.createGain();
    o.type='sine'; o.frequency.setValueAtTime(150,t);
    o.frequency.exponentialRampToValueAtTime(55,t+0.18);
    g.gain.setValueAtTime(1,t); g.gain.exponentialRampToValueAtTime(0.001,t+0.2);
    o.connect(g); g.connect(beatG); o.start(t); o.stop(t+0.21);}
  function hat(t){ const b=ctxA.createBuffer(1,2205,44100), d=b.getChannelData(0);
    for(let i=0;i<d.length;i++) d[i]=(Math.random()*2-1)*((b.length-i)/b.length);
    const s=ctxA.createBufferSource(); s.buffer=b; const g=ctxA.createGain(); g.gain.value=0.18;
    s.connect(g); g.connect(beatG); s.start(t); }
  function note(freq,t,len=0.28){ const o=ctxA.createOscillator(); o.type='triangle';
    const g=ctxA.createGain(); g.gain.value=0.0001; g.gain.linearRampToValueAtTime(0.28,t+0.02);
    g.gain.exponentialRampToValueAtTime(0.001,t+len); o.frequency.value=freq; o.connect(g); g.connect(melG);
    o.start(t); o.stop(t+len+0.05); }
  function start(){ init(); if(started) return; started=true;
    const tempo=116, spb=60/tempo; let step=0;
    function tick(){ const now=ctxA.currentTime;
      for(let tt=now; tt<now+0.3; tt+=spb){ const s=step++; if(s%2===0) kick(tt); hat(tt+spb*0.5);
        const scale=[261.63,329.63,392.00,493.88,587.33]; note(scale[(s>>2)%scale.length], tt+0.01, 0.24);}
      timer=setTimeout(tick,100);} tick(); }
  function stop(){ started=false; clearTimeout(timer); }
  function toggleMute(){ muted=!muted; if(master) master.gain.value = muted?0:0.16; }
  return {start,stop,toggleMute};
})();

/* ===== leaderboard ===== */
const LB=(()=>{
  const load=()=>JSON.parse(localStorage.getItem(LS_LB)||'[]');
  const save=a=>localStorage.setItem(LS_LB,JSON.stringify(a));
  const add=puan=>{ const ad=($('#ad').value||'Runebe').trim().slice(0,12);
    localStorage.setItem(LS_NAME,ad);
    const arr=load(); arr.push({ad,puan,at:new Date().toISOString()});
    arr.sort((a,b)=>b.puan-a.puan || a.at.localeCompare(b.at)); save(arr.slice(0,10)); render(); };
  const render=()=>{ const tb=$('#lbTable tbody'); tb.innerHTML='';
    load().forEach((r,i)=>{ const tr=document.createElement('tr');
      tr.innerHTML=`<td>${i+1}</td><td>${r.ad}</td><td>${r.puan}</td><td>${new Date(r.at).toLocaleDateString()}</td>`;
      tb.appendChild(tr); }); };
  return {add,render};
})();

/* ===== game state ===== */
let calisiyor=false, durak=false, t=0, last=0;
let hiz=7.5, vx=0, x=120, y=H-160, vy=0, yerde=true;
let can=3, puan=0, combo=0, ilerleme=0, zorluk=0;
let malzemeler=[], engeller=[], efekts=[];

/* camera (only horizontal flow now) */
let camX=0;
const PX=260;                    // player fixed X (temple-run hissi)
const GROUND_Y=H-140;            // yol yüksekliği

/* items */
const MALZ=[
  {tur:'Doğum Seti',   puan:30, c:'#ffd166'},
  {tur:'Şırınga',      puan:18, c:'#06d6a0'},
  {tur:'Kordon Makası',puan:20, c:'#b095ff'},
  {tur:'Bebek Bezi',   puan:12, c:'#ff7aa2'},
  {tur:'Önlük',        puan:14, c:'#73b7ff'},
  {tur:'Eldiven',      puan:10, c:'#5ce1c6'},
  {tur:'Maske',        puan:12, c:'#8bb8ff'}
];

/* draw helpers */
function rr(x,y,w,h,r){const q=Math.min(r,w/2,h/2);ctx.beginPath();
  ctx.moveTo(x+q,y);ctx.arcTo(x+w,y,x+w,y+h,q);ctx.arcTo(x+w,y+h,x,y+h,q);
  ctx.arcTo(x,y+h,x,y,q);ctx.arcTo(x,y,x+w,y,q);ctx.closePath();}

/* colorful parallax corridor (no vertical rising blocks) */
function drawScene(){
  // arka plan gradyan
  const sky=ctx.createLinearGradient(0,0,0,H);
  sky.addColorStop(0,'#141e30'); sky.addColorStop(1,'#243b55');
  ctx.fillStyle=sky; ctx.fillRect(0,0,W,H);

  // parallax duvar çizgileri
  ctx.strokeStyle='rgba(255,255,255,.08)'; ctx.lineWidth=2;
  for(let i=0;i<6;i++){
    const px = ((i*260) - (camX*0.4)) % (W+260) - 60;
    ctx.beginPath(); ctx.moveTo(px,120); ctx.lineTo(px+60,140); ctx.lineTo(px+60,H-160); ctx.lineTo(px, H-180); ctx.closePath(); ctx.stroke();
  }

  // posterler (renkli)
  for(let i=0;i<4;i++){
    const px=((i*360)-(camX*0.6))%(W+200)-40, py=140;
    ctx.fillStyle=['#ffd166','#06d6a0','#b095ff','#ff7aa2'][i%4];
    rr(px,py,90,120,10); ctx.fill();
  }

  // yol (renkli şeritli, sabit)
  const roadTop=GROUND_Y-20, roadBottom=GROUND_Y+60;
  const roadGrad=ctx.createLinearGradient(0,roadTop,0,roadBottom);
  roadGrad.addColorStop(0,'#2d3548'); roadGrad.addColorStop(1,'#1f2636');
  ctx.fillStyle=roadGrad; ctx.fillRect(0,roadTop,W,roadBottom-roadTop);

  // yol şeritleri (akış hissi)
  ctx.strokeStyle='#ffd166'; ctx.lineWidth=6; ctx.setLineDash([28,24]);
  ctx.lineDashOffset = - (camX*0.8)%52;
  ctx.beginPath(); ctx.moveTo(0,GROUND_Y+16); ctx.lineTo(W,GROUND_Y+16); ctx.stroke();
  ctx.setLineDash([]);

  // yan şeritler
  ctx.fillStyle='#06d6a0'; ctx.fillRect(0,GROUND_Y-4,W,4);
  ctx.fillStyle='#8bb8ff'; ctx.fillRect(0,GROUND_Y+40,W,4);
}

/* items */
function halo(x,y,r){ const g=ctx.createRadialGradient(x,y,r*0.2,x,y,r);
  g.addColorStop(0,'rgba(255,255,255,.35)'); g.addColorStop(1,'rgba(255,255,255,0)');
  ctx.fillStyle=g; ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.fill(); }

function drawItem(m){
  ctx.save(); ctx.translate(m.x,m.y); ctx.lineWidth=3;
  const c=m.c;
  if(m.tur==='Doğum Seti'){ ctx.fillStyle=c; rr(-16,-12,32,24,6); ctx.fill(); ctx.fillStyle='rgba(255,255,255,.8)'; rr(-10,-4,20,8,3); ctx.fill(); }
  else if(m.tur==='Şırınga'){ ctx.strokeStyle=c; ctx.lineWidth=2.5; rr(-10,-6,20,12,3); ctx.stroke(); ctx.beginPath(); ctx.moveTo(-12,0); ctx.lineTo(-18,0); ctx.stroke(); ctx.beginPath(); ctx.moveTo(10,0); ctx.lineTo(20,0); ctx.stroke(); }
  else if(m.tur==='Kordon Makası'){ ctx.strokeStyle=c; ctx.lineWidth=3; ctx.beginPath(); ctx.arc(-6,0,6,0,Math.PI*2); ctx.arc(8,0,6,0,Math.PI*2); ctx.stroke(); ctx.beginPath(); ctx.moveTo(-2,0); ctx.lineTo(14,-10); ctx.stroke(); }
  else if(m.tur==='Bebek Bezi'){ ctx.fillStyle=c; rr(-14,-10,28,20,8); ctx.fill(); ctx.fillStyle='rgba(255,255,255,.7)'; rr(-10,-6,20,12,6); ctx.fill(); }
  else if(m.tur==='Önlük'){ ctx.fillStyle=c; rr(-12,-6,24,20,6); ctx.fill(); ctx.fillStyle='#fff'; rr(-6,-2,12,8,3); ctx.fill(); }
  else if(m.tur==='Eldiven'){ ctx.fillStyle=c; rr(-12,-10,24,20,8); ctx.fill(); ctx.fillRect(2,-14,6,10); }
  else if(m.tur==='Maske'){ ctx.fillStyle=c; rr(-14,-6,28,12,6); ctx.fill(); ctx.strokeStyle=c; ctx.lineWidth=2; ctx.beginPath();
    ctx.moveTo(-14,-2); ctx.lineTo(-20,-4); ctx.moveTo(-14,2); ctx.lineTo(-20,4);
    ctx.moveTo(14,-2);  ctx.lineTo(20,-4); ctx.moveTo(14,2);  ctx.lineTo(20,4); ctx.stroke();}
  ctx.globalAlpha=.35; ctx.fillStyle='#fff'; ctx.beginPath(); ctx.ellipse(-8,-10,14,6,-0.5,0,Math.PI*2); ctx.fill();
  ctx.globalAlpha=1; ctx.restore();
}

/* player */
function drawPlayer(){
  // gövde
  ctx.fillStyle='#ffd166'; rr(x,y,44,44,12); ctx.fill();
  // baş
  const hx=x+22, hy=y-10;
  ctx.fillStyle='#ffe0a6'; ctx.beginPath(); ctx.arc(hx,hy,15,0,Math.PI*2); ctx.fill();
  // saç (koştukça sallansın)
  const sal=Math.sin(t*10)*4 + (vx>0?1:0);
  ctx.fillStyle='#2c2a47'; ctx.beginPath(); ctx.ellipse(hx-10-sal,hy+2,13,9,-0.25,0,Math.PI*2); ctx.fill();
  // göz
  ctx.fillStyle='#1a1a1a'; ctx.beginPath(); ctx.arc(hx+4,hy-2,2,0,Math.PI*2); ctx.fill();
}

/* spawn — world coords */
function spawnItem(){
  const lanes=[0,40,80]; const m=MALZ[Math.floor(Math.random()*MALZ.length)];
  const worldX=camX+W+80+Math.random()*260;
  malzemeler.push({tur:m.tur,puan:m.puan,c:m.c,X:worldX,y:GROUND_Y-50-lanes[Math.floor(Math.random()*lanes.length)]});
}
function spawnObstacle(){
  const r=Math.random(); const worldX=camX+W+120+Math.random()*280;
  if(r<0.4)      engeller.push({tip:'temizlik',X:worldX,y:GROUND_Y-6,w:70,h:18});              // Islak Temizlik Alanı
  else if(r<0.7) engeller.push({tip:'araba',   X:worldX,y:GROUND_Y-36,w:56,h:26,vy:(Math.random()<.5?0.4:-0.4)}); // Ekipman Arabası
  else           engeller.push({tip:'kapi',    X:worldX,y:GROUND_Y-50,w:44,h:50});            // Servis Kapısı
}

/* reset */
function reset(){
  camX=0; hiz=7.5; vx=0; x=PX; y=GROUND_Y-40; vy=0; yerde=true;
  can=3; puan=0; combo=0; ilerleme=0; zorluk=0;
  malzemeler=[]; engeller=[]; efekts=[];
}

/* tick */
function tick(dt){
  zorluk += dt*0.06;
  hiz = 7.5 + zorluk*1.2 + Math.min(2, Math.floor(puan/240)*0.5);
  t += dt;

  camX += hiz;                 // sadece yatay akış (dikey pan YOK)

  // oyuncu fizik
  x = PX + vx;
  vy += 0.9; y += vy;
  if(y>GROUND_Y-40){ y=GROUND_Y-40; vy=0; yerde=true; }

  // spawn
  if (t%1 < dt){
    const ic=0.65+Math.min(.2,zorluk*0.15), oc=0.22+Math.min(.45,zorluk*0.25);
    if(Math.random()<ic) spawnItem();
    if(Math.random()<oc) spawnObstacle();
  }

  // hareketli engel (araba) hafif salınım
  engeller.forEach(h=>{ if(h.tip==='araba'){ h.y += h.vy; if(h.y<GROUND_Y-60 || h.y>GROUND_Y-28) h.vy*=-1; }});

  // ekran dışını temizle
  malzemeler = malzemeler.filter(c=> (c.X - camX) > -80 );
  engeller   = engeller.filter(h=> (h.X - camX) > -90 );

  // çarpışmalar
  malzemeler = malzemeler.filter(c=>{
    const sx=c.X-camX;
    const hit=Math.hypot((x+22)-sx,(y+22)-c.y)<28;
    if(hit){ puan+=c.puan*(1+Math.floor(combo/5)); combo++; ilerleme++;
      efekts.push({x:sx,y:c.y,txt:`+${c.puan} ${c.tur}`,t:0}); }
    return !hit;
  });
  engeller = engeller.filter(h=>{
    const sx=h.X-camX; let hit=false;
    hit = (x+44>sx && x<sx+(h.w||0) && y+44>h.y && y<h.y+(h.h||0));
    if(hit){ can--; combo=0; }
    return !hit;
  });

  if(ilerleme>=60){ ilerleme=0; hiz+=0.5; }
  if(can<=0) gameOver();
}

/* draw */
function draw(){
  drawScene();

  // items
  malzemeler.forEach(c=>{ const sx=c.X-camX; drawItem({x:sx,y:c.y,tur:c.tur,c:c.c}); halo(sx,c.y,18); });

  // obstacles (renkli & net)
  engeller.forEach(h=>{
    const sx=h.X-camX;
    if(h.tip==='temizlik'){
      ctx.fillStyle='rgba(99, 196, 255, .85)'; rr(sx,h.y,h.w,h.h,10); ctx.fill();
      ctx.globalAlpha=.25; ctx.fillStyle='#fff'; rr(sx+8,h.y+4,h.w-16,h.h-8,8); ctx.fill(); ctx.globalAlpha=1;
    } else if(h.tip==='araba'){
      ctx.fillStyle='#ff7aa2'; rr(sx,h.y,h.w,h.h,6); ctx.fill();
      ctx.fillStyle='#111'; ctx.beginPath(); ctx.arc(sx+10,h.y+h.h,5,0,Math.PI*2); ctx.fill();
      ctx.beginPath(); ctx.arc(sx+h.w-10,h.y+h.h,5,0,Math.PI*2); ctx.fill();
    } else { // kapi
      ctx.fillStyle='#b095ff'; rr(sx,h.y,h.w,h.h,6); ctx.fill();
      ctx.fillStyle='rgba(255,255,255,.25)'; rr(sx+6,h.y+6,h.w-12,8,4); ctx.fill();
    }
  });

  // player
  drawPlayer();

  // efekts
  ctx.font='16px system-ui'; ctx.textAlign='left';
  efekts = efekts.filter(e=>{ e.t+=0.02; ctx.globalAlpha=1-e.t; ctx.fillStyle='#fff';
    ctx.fillText(e.txt,e.x+10,e.y-10-e.t*26); ctx.globalAlpha=1; return e.t<1; });

  // HUD
  ctx.fillStyle='#fff'; ctx.textAlign='left'; ctx.font='18px system-ui';
  ctx.fillText(`Puan: ${puan}`,20,34);
  ctx.fillText(`Can: ${'♥'.repeat(can)}`,20,60);
  ctx.fillText(`Hız: ${hiz.toFixed(1)}x`,20,86);
  const w=220,p=ilerleme/60; ctx.strokeStyle='rgba(255,255,255,.25)'; ctx.strokeRect(20,96,w,10);
  ctx.fillStyle='#06d6a0'; ctx.fillRect(20,96,w*p,10);
}

/* loop */
function loop(ts){ if(!calisiyor||durak){ last=ts; requestAnimationFrame(loop); return; }
  const dt=Math.min(0.033,(ts-last)/1000||0.016); last=ts; tick(dt); draw(); requestAnimationFrame(loop); }

/* lifecycle */
function start(){ $('#panel').style.display='none'; calisiyor=true; durak=false; reset();
  if(Muzik) Muzik.start(); last=performance.now(); requestAnimationFrame(loop); }
function gameOver(){ calisiyor=false; if(Muzik) Muzik.stop();
  $('#sonPuan').textContent='Puan: '+puan; LB.add(puan);
  $('#titleArea').style.display='none'; $('#howto').style.display='none'; $('#lbArea').style.display='none';
  $('#overArea').style.display='block'; $('#panel').style.display='flex'; }

/* controls */
const tus={};
addEventListener('keydown',e=>{
  tus[e.code]=true;
  if(e.code==='ArrowRight') vx=4;
  if(e.code==='ArrowLeft')  vx=-3;
  if(e.code==='Space'){ if(yerde){ vy=-16;yerde=false; } else if(vy>-2){ vy=-14; } }
  if(e.code==='KeyS'){ vy=8; }
  if(e.code==='KeyD'){ x+=46; }
  if(e.code==='KeyP'){ durak=!durak; }
  if(e.code==='KeyM'){ if(Muzik) Muzik.toggleMute(); }
});
addEventListener('keyup',e=>{ tus[e.code]=false; if(!tus['ArrowRight'] && !tus['ArrowLeft']) vx=0; });

function bind(id,down,up){ const el=$(id); if(!el) return;
  const press=e=>{e.preventDefault();down();}, rel=e=>{e.preventDefault();up&&up();};
  el.addEventListener('touchstart',press); el.addEventListener('touchend',rel);
  el.addEventListener('mousedown',press); el.addEventListener('mouseup',rel);
}
bind('#sol', ()=>{vx=-3;}, ()=>{ if(!tus['ArrowRight']) vx=0; });
bind('#sag', ()=>{vx= 4;}, ()=>{ if(!tus['ArrowLeft'])  vx=0; });
bind('#zip', ()=>{ if(yerde){vy=-16;yerde=false;} else if(vy>-2){vy=-14;} });
bind('#kay', ()=>{ vy=8; });
bind('#dash',()=>{ x+=46; });

document.addEventListener('DOMContentLoaded',()=>{
  const n=localStorage.getItem(LS_NAME); if(n) $('#ad').value=n;
  $('#basla').onclick=()=>start();
  $('#muzik').onclick=()=>{ if(Muzik) Muzik.toggleMute(); };
  $('#lider').onclick=()=>{ LB.render(); $('#titleArea').style.display='none'; $('#lbArea').style.display='block'; };
  $('#kapatLB').onclick=()=>{ $('#lbArea').style.display='none'; $('#titleArea').style.display='block'; };
  $('#yardim').onclick=()=>{ $('#titleArea').style.display='none'; $('#howto').style.display='block'; };
  $('#kapatHow').onclick=()=>{ $('#howto').style.display='none'; $('#titleArea').style.display='block'; };
  $('#yeniden').onclick=()=>start();
  $('#baslangic').onclick=()=>{ $('#overArea').style.display='none'; $('#lbArea').style.display='none'; $('#howto').style.display='none'; $('#titleArea').style.display='block'; };
  draw();
});
</script>
</body>
</html>
